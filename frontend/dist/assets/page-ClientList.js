import{r as s,j as t}from"./vendor-react.js";import"./page-AddClient.js";import{a as X,b as Y,d as Z,e as ee}from"./api.js";import{F as te}from"./component-FullClientTable.js";import{C as ae}from"./component-ClientDetailsTable.js";import{N as se}from"./component-NotificationConfigTable.js";import{u as w,w as ne}from"./vendor-xlsx.js";function fe(){const[V,E]=s.useState([]),[$,S]=s.useState([]),[H,j]=s.useState([]),[O,N]=s.useState(!0),[T,oe]=s.useState(""),[n,m]=s.useState("app"),[k,J]=s.useState(""),[h,q]=s.useState("clientName"),[F,I]=s.useState("asc"),[D,u]=s.useState(!1),L=s.useCallback(async()=>{try{const e=await X();E(Array.isArray(e)?e:[])}catch{E([])}},[]),A=s.useCallback(async()=>{try{const e=await Y();S(Array.isArray(e)?e:[])}catch{S([])}},[]),R=s.useCallback(async()=>{try{const e=await Z();j(Array.isArray(e)?e:[])}catch{j([])}},[]),b=s.useCallback(async()=>{N(!0),await Promise.all([L(),A(),R()]),N(!1)},[L,A,R]);s.useEffect(()=>{b()},[b]);const W=async e=>{if(window.confirm("Delete this client?"))try{await ee(e),b()}catch{alert("Error deleting client")}},g=e=>{const a=k.toLowerCase();return a?e.filter(o=>JSON.stringify(o).toLowerCase().includes(a)):e},z=(e,a,o)=>o?Number(e||0)-Number(a||0):String(e||"").localeCompare(String(a||""),void 0,{sensitivity:"base"}),x=e=>{const a=h,o=a==="id";return[...e].sort((d,i)=>{const c=z(d[a],i[a],o);return F==="asc"?c:-c})},C=e=>{u(!1),h===e?I(a=>a==="asc"?"desc":"asc"):(q(e),I("asc"))},y=e=>h===e?F==="asc"?"â–²":"â–¼":"",M=x(g(V)),_=x(g($)),B=x(g(H)),U=()=>n==="app"?M:n==="details"?_:B,v={app:{fileName:"client_app_details",cols:["id","clientName","defaultLanguage","listOfLanguage","defaultDisplayLanguage","listOfDisplayLanguage","headerLogo","poweredByLogo","productLogo","homeLauncherLogo","menuColor","subMenuColor","textColor","mobileHeaderColor","mobileMenuBgColor","homeBgColor","headerText","welcomeText","welcomeBody"]},details:{fileName:"client_details",cols:["id","clientName","dbName","baseClient","medianFlag","stateMaintainHours","recentAlertHours","notificationListHours","trashEnabled","paperEnabled","hvacEnabled","waterFlowEnabled","feedbackEnabled","soapDispenserEnabled","airFreshenerEnabled","cleanIndexEnabled","heatMapEnabled","schedulerEnabled","peopleCountEnabled","typicalHighValue","cleaningThreshold","analyticsWeekEndRestrictionFlag","trafficSensor","appViewType","feedbackAlertConfig","beaconTimeInterval","soapShots","pumpPercentage","soapPredictionIsEnabled","labelFlag","weatherEnabled","language","occupancyDurationLimit","passwordRotationInterval","mfaFlag","pageReloadInterval","inspectionType","defaultGradingflag","commentsLimit","janitorScheduleFlag","publisherType","availableSensors","feedbackType","feedbackAlertOrder","feedbackDefaultTimeout","overViewStartTime","cannedChartPeriod","dataPostingType"]},notif:{fileName:"notification_config",cols:["id","clientName","push","timeRestriction","weekendRestriction","alertInterval","janitorIssueInterval","maintenanceIssueInterval","feedbackDuplicateFilterInterval","feedbackFilterCount","deviceEmailFlag","feedbackCombinedFlag","feedbackEmailFlag","feedbackTextFlag","deviceTextFlag","qrJanitorpush","qrJanitorTextFlag","qrJanitorEmailFlag","openAreaTrafficFlag","escalationType","escalationLevel1Interval","escalationLevel2Interval","notCleanEscalationInterval","cleaningScheduleFlag","dispatchedInterval","deviceDataTimeInterval","toiletPaperThreshold","paperTowelThreshold","trashThreshold","areaAlertThreshold","trafficAlert"]}},P=()=>{const e=U();return e.length?{...n==="app"?v.app:n==="details"?v.details:v.notif,rows:e}:null},G=()=>{const e=P();if(!e)return;const{cols:a,rows:o,fileName:d}=e,i=a.join(","),c=o.map(p=>a.map(Q=>`"${String((p==null?void 0:p[Q])??"").replace(/"/g,'""')}"`).join(",")).join(`
`),f=new Blob([i+`
`+c],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(f),r.download=`${d}.csv`,r.click()},K=()=>{const e=P();if(!e)return;const{cols:a,rows:o,fileName:d}=e,i=[];i.push(a),o.forEach(r=>i.push(a.map(p=>(r==null?void 0:r[p])??"")));const c=w.aoa_to_sheet(i),f=w.book_new();w.book_append_sheet(f,c,"Data"),ne(f,`${d}.xlsx`)};return O?t.jsx("div",{className:"page1",children:t.jsx("div",{className:"spinner"})}):t.jsxs("div",{className:"page1",children:[T&&t.jsx("div",{className:"message-box danger",children:T}),t.jsxs("div",{style:l.topBar,children:[t.jsx("div",{style:l.searchWrapper,children:t.jsx("input",{type:"text",placeholder:"Search...",value:k,onChange:e=>J(e.target.value),style:l.searchInput})}),t.jsxs("div",{style:l.tabs,children:[t.jsx("button",{className:`tab-modern-btn ${n==="app"?"active":""}`,onClick:()=>m("app"),children:"Client App Details"}),t.jsx("button",{className:`tab-modern-btn ${n==="details"?"active":""}`,onClick:()=>m("details"),children:"Client Details"}),t.jsx("button",{className:`tab-modern-btn ${n==="notif"?"active":""}`,onClick:()=>m("notif"),children:"Notification Config"})]}),t.jsxs("div",{style:{position:"relative"},children:[t.jsx("button",{className:"btn primary",onClick:()=>u(!D),children:"Export â–¾"}),D&&t.jsxs("div",{style:l.exportMenu,children:[t.jsx("div",{style:l.exportItem,onClick:()=>{K(),u(!1)},children:"ðŸ“˜ Export as Excel"}),t.jsx("div",{style:l.exportItem,onClick:()=>{G(),u(!1)},children:"ðŸ§¾ Export as CSV"})]})]})]}),t.jsxs("div",{className:"table-wrapper",children:[n==="app"&&t.jsx(te,{clients:M,handleSort:C,getSortArrow:y,onDelete:W}),n==="details"&&t.jsx(ae,{rows:_,handleSort:C,getSortArrow:y}),n==="notif"&&t.jsx(se,{rows:B,handleSort:C,getSortArrow:y})]})]})}const l={topBar:{display:"flex",alignItems:"center",gap:20,marginBottom:20},searchWrapper:{position:"relative",width:210},searchInput:{width:"100%",padding:"8px 10px 8px 36px",borderRadius:8,border:"1px solid #ccc",fontSize:14},tabs:{display:"flex",gap:14,flex:1,justifyContent:"center"},exportMenu:{position:"absolute",top:"105%",right:0,width:180,background:"#fff",borderRadius:8,border:"1px solid #e5e7eb",boxShadow:"0 8px 24px rgba(0,0,0,0.25)",padding:6,zIndex:999},exportItem:{padding:"8px 12px",cursor:"pointer",borderRadius:6}};export{fe as C};
