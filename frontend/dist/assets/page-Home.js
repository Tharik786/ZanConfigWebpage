import{r as x,j as t}from"./vendor-react.js";import{u as j,w as S}from"./vendor-xlsx.js";import{h as L}from"./api.js";function s(a){if(!a||typeof a!="string")return"-";const c=a.split(" ");if(c.length!==2)return"-";const[l,p,r]=c[0].split("-");let[i,o]=c[1].split(":");i=parseInt(i,10);const f=i>=12?"pm":"am";return i=i%12||12,`${r} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][p-1]} ${l}, ${i.toString().padStart(2,"0")}:${o} ${f}`}function h(a){if(!a||typeof a!="string")return!1;try{const c=new Date(a.split(" ")[0]),l=new Date;c.setHours(0,0,0,0),l.setHours(0,0,0,0);const p=c-l,r=Math.floor(p/(1e3*60*60*24));return r<=-2||r>=2}catch{return!1}}function v(){const[a,c]=x.useState([]),[l,p]=x.useState(!0),[r,i]=x.useState(""),[o,f]=x.useState("All Clients");x.useEffect(()=>{async function e(){try{const d=new Date,u=d.getFullYear(),n=d.getMonth()+1,y=await L(u,n);c(Array.isArray(y)?y:[])}catch(d){console.error(d),i("Failed to load dashboard data")}finally{p(!1)}}e()},[]);const g=["All Clients",...Array.from(new Set(a.map(e=>e.clientName)))],m=o==="All Clients"?a:a.filter(e=>e.clientName===o);function N(){if(!m.length)return;const e=m.map(n=>({ClientName:n.clientName,CurrentTime:s(n.currentTime),DeviceStatus:s(n.deviceStatusLastUpdated),PeopleCount:s(n.peopleLastUpdated),Analytics:s(n.analyticsLastUpdated),Flight:s(n.flightLastUpdated),Traffic:s(n.trafficLastUpdated)})),d=j.json_to_sheet(e),u=j.book_new();j.book_append_sheet(u,d,"Dashboard"),S(u,`dashboard_${o.replace(/\s+/g,"_")}.xlsx`)}return t.jsx("div",{className:"layout",children:t.jsx("main",{className:"content",children:t.jsxs("div",{className:"main-view",children:[t.jsxs("div",{className:"header-bar",children:[t.jsx("h2",{children:"Device Monitoring Status"}),t.jsx("button",{className:"export-btn",onClick:N,disabled:!m.length,children:"Export Excel"})]}),t.jsx("div",{className:"client-menu-bar",children:t.jsx("select",{className:"client-select",value:o,onChange:e=>f(e.target.value),children:g.map(e=>t.jsx("option",{value:e,children:e},e))})}),t.jsx("div",{className:"table-container",children:t.jsxs("table",{children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Client"}),t.jsx("th",{children:"Current Time"}),t.jsx("th",{children:"Device Status"}),t.jsx("th",{children:"People Count"}),t.jsx("th",{children:"Analytics"}),t.jsx("th",{children:"Flight"}),t.jsx("th",{children:"Traffic"})]})}),t.jsxs("tbody",{children:[l&&t.jsx("tr",{children:t.jsx("td",{colSpan:"7",children:"Loadingâ€¦"})}),!l&&r&&t.jsx("tr",{children:t.jsx("td",{colSpan:"7",children:r})}),!l&&!m.length&&t.jsx("tr",{children:t.jsx("td",{colSpan:"7",children:"No data available"})}),!l&&m.map((e,d)=>t.jsxs("tr",{children:[t.jsx("td",{children:e.clientName}),t.jsx("td",{className:h(e.currentTime)?"stale-cell":"",children:s(e.currentTime)}),t.jsx("td",{className:h(e.deviceStatusLastUpdated)?"stale-cell":"",children:s(e.deviceStatusLastUpdated)}),t.jsx("td",{className:h(e.peopleLastUpdated)?"stale-cell":"",children:s(e.peopleLastUpdated)}),t.jsx("td",{className:h(e.analyticsLastUpdated)?"stale-cell":"",children:s(e.analyticsLastUpdated)}),t.jsx("td",{className:h(e.flightLastUpdated)?"stale-cell":"",children:s(e.flightLastUpdated)}),t.jsx("td",{className:h(e.trafficLastUpdated)?"stale-cell":"",children:s(e.trafficLastUpdated)})]},d))]})]})})]})})})}export{v as H};
